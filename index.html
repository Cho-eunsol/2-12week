<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>능력 찾기 게임</title>
<style>
:root {
  --accent: #5b6b7d;
  --accent2: #7190FF;
  --bg: #000000;
  --text: #a7b3c2;
}

html, body { height: 100%; margin: 0; }
body {
  background: var(--bg) url('background.jpg') no-repeat center center fixed;
  background-size: cover;
  color: var(--text);
  font-family: Pretendard, sans-serif;
  overflow: hidden;
  position: relative;
}

#overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0,0,0,0.8);
  z-index: 1;
  pointer-events: none;
}

.game-intro { 
  top: 50px; 
  text-align: center; 
  font-size: 1rem; 
  color: #7190FF; 
  opacity: 0.9; 
  margin-top: 20px; 
  margin-bottom: -5px; 
  letter-spacing: 0.03em; 
  text-shadow: 0 0 6px rgba(0,150,255,0.3); 
  z-index: 10; 
  position: relative; 
}

h1 { 
  text-align: center; 
  top: 60px; 
  margin: 10px 0 5px; 
  color: var(--accent2); 
  font-size: 1.2rem; 
  font-weight: 600; 
  position: relative; 
  z-index: 10; 
  pointer-events: none; 
  text-shadow: 0 0 10px rgba(0,180,255,0.6); 
}

#game-area { 
  position: relative; 
  width: 100vw; 
  height: calc(100vh - 60px); 
  overflow: hidden; 
  z-index: 10;
}

.round-layer { 
  position: absolute; 
  left:0; top:0; width:100%; height:100%; 
  pointer-events: none; 
  z-index: 10;
}

.word { 
  position: absolute; 
  font-size: 1rem; 
  cursor: pointer; 
  user-select: none; 
  transition: transform 0.25s ease, color 0.25s ease, left 0.35s ease, top 0.35s ease, opacity 0.3s; 
  opacity: 0.85; 
  z-index: 10; 
  white-space: nowrap; 
  color: var(--text); 
  text-shadow: 0 0 2px rgba(0,128,255,0.2); 
  pointer-events: auto; 
}

.word:hover { 
  color: var(--accent2); 
  text-shadow: 0 0 2px rgba(0,150,255,0.8); 
}

.target-word { 
  font-weight: 500; 
  font-size: 1.1rem; 
  color: var(--accent2); 
  text-shadow: 0 0 2px rgba(0,150,255,0.9); 
}

@keyframes correctPulse { 
  0%,100%{ transform: scale(1); color:#7190FF; text-shadow:0 0 10px #7190FF;} 
  50%{transform: scale(1.15); color:#fff; text-shadow:0 0 25px #7190FF; } 
}

.correct { 
  animation: correctPulse 0.7s ease forwards; 
  pointer-events: none; 
}

canvas#particleCanvas, canvas#burstCanvas { 
  position: fixed; 
  left:0; top:0; 
  pointer-events: none; 
}

canvas#particleCanvas { z-index: 10; }
canvas#burstCanvas { z-index: 10; }

#ability-inventory { 
  position: fixed; 
  right: 100px; 
  top: 80px; 
  width: 150px; 
  padding: 10px; 
  background: rgba(0,0,0,0.45); 
  border-radius: 5px; 
  color: var(--text); 
  z-index: 10; 
}

#ability-inventory h2 {
  font-size: 1rem; 
  text-align: center; 
  margin:0 0 10px 0; 
  color:#7190FF; 
}

#inventory-list { 
  display:flex; 
  flex-direction: column; 
  gap:10px; 
}

.inventory-item { 
  font-size:0.85rem; 
  padding:4px 8px; 
  background:#2f3e52; 
  color:#d1d9e8; 
  border-radius:3px; 
  text-align:center; 
  border:0px solid #3f5065; 
  opacity:1; 
}

#game-record { 
  position: fixed; 
  left: 100px; 
  top: 80px; 
  width: 200px; 
  padding: 10px; 
  background: rgba(0,0,0,0.45); 
  border-radius: 5px; 
  color: var(--text); 
  z-index: 10; 
}

#game-record h2 { 
  font-size: 1rem; 
  text-align: center; 
  margin: 0 0 5px 0; 
  color: #7190FF; 
}

#record-stats div, #record-log div { 
  font-size: 0.85rem; 
  padding:4px 8px; 
  background:#2f3e52; 
  color:#d1d9e8; 
  border-radius:3px; 
  text-align:center; 
  margin-bottom:4px; 
}

/* 타이머를 기록 박스 오른쪽에 배치 */
#round-timer {
  position: fixed;
  top: 16.5%;               /* 기록 박스 높이 중앙 */
  right: 847px;           /* 기록 박스 오른쪽에 적절한 간격 */
  transform: translateY(-50%);
  font-size: 1.2rem;
  color: #7190FF;
  z-index: 20;
  text-shadow: 0 0 6px rgba(0,150,255,0.5);
}

</style>
</head>
<body>
<div id="overlay"></div>

<canvas id="particleCanvas"></canvas>
<canvas id="burstCanvas"></canvas>

<div class="game-intro">✦ 숨겨진 능력 ✦</div>
<h1 id="target-word">?</h1>
<div id="game-area"></div>

<div id="ability-inventory">
  <h2>획득한 능력</h2>
  <div id="inventory-list"></div>
</div>

<div id="game-record">
  <h2>게임 기록</h2>
  <div id="record-stats">
    <div>성공: <span id="win-count">0</span></div>
    <div>실패: <span id="lose-count">0</span></div>
  </div>
  <h2>-</h2>
  <h2>최근 기록</h2>
  <div id="record-log"></div>
</div>

<div id="round-timer">10</div>

<script>
// ===== 데이터 =====
const abilities = ["용기","지혜","열정","창의력","인내"];
const distractors = [
  "욕심","결단","감정","성실","희망","명예","신념","배려","호기심","헌신",
  "유혹","책임","관용","절제","관찰","근성","정의","의심","열망","신중",
  "겸손","사랑","두려움","관심","자존심","도전정신","희생","긍정","의지",
  "냉정","통찰","연민","상상","창조","몰입","끈기","열정","집중력",
  "포용","도덕","정직","사고력","소통","공감","추진력","지혜","창의력",
  "용기","인내","균형","유연함","책임감","헌신","배려심","도전","결단력"
];
const colors = ["#2f3e52","#3f5065","#4e627a","#5d7390"];
let inventoryStatus = Array(abilities.length).fill(false);

const targetEl = document.getElementById('target-word');
const area = document.getElementById('game-area');
const burstCanvas = document.getElementById('burstCanvas');
const burstCtx = burstCanvas.getContext('2d');
const timerEl = document.getElementById('round-timer');

let currentTarget = "";
let wordObjects = [];
let currentLayer;
let roundTimer, countdownInterval;

// ===== 인벤토리 =====
function initInventory() {
  const list = document.getElementById('inventory-list');
  list.innerHTML = "";
  abilities.forEach(() => {
    const item = document.createElement('div');
    item.className = 'inventory-item';
    item.textContent = "-";
    list.appendChild(item);
  });
}
initInventory();

function addToInventory(word) {
  const index = abilities.indexOf(word);
  if(index === -1 || inventoryStatus[index]) return;
  inventoryStatus[index] = true;
  document.getElementById('inventory-list').children[index].textContent = word;
}

const recordLog = document.getElementById('record-log');
function addRecordLog(msg) {
  const div=document.createElement('div');
  div.textContent=msg;
  recordLog.prepend(div);
  if(recordLog.children.length>5) recordLog.removeChild(recordLog.lastChild);
}

// ===== 폭발 =====
function resizeBurstCanvas() { burstCanvas.width = window.innerWidth; burstCanvas.height = window.innerHeight; }
resizeBurstCanvas(); window.addEventListener('resize',resizeBurstCanvas);
function burstEffect(x,y){
  const particles=[];
  for(let i=0;i<40;i++){
    particles.push({ x,y, vx:(Math.random()-0.5)*6, vy:(Math.random()-0.5)*6, life:30+Math.random()*20, size:2+Math.random()*2, color: colors[Math.floor(Math.random()*colors.length)] });
  }
  const animate=()=>{
    burstCtx.clearRect(0,0,burstCanvas.width,burstCanvas.height);
    particles.forEach(p=>{
      p.x+=p.vx; p.y+=p.vy; p.vx*=0.95; p.vy*=0.95; p.life--;
      const alpha=p.life/50;
      burstCtx.beginPath(); burstCtx.fillStyle=p.color; burstCtx.globalAlpha=Math.max(0,alpha);
      burstCtx.arc(p.x,p.y,p.size,0,Math.PI*2); burstCtx.fill();
      burstCtx.globalAlpha=1;
    });
    if(particles.some(p=>p.life>0)) requestAnimationFrame(animate);
  }
  animate();
}

// ===== 단어 생성 =====
function spawnWords(targetWord, count=1) {
  const centerX = window.innerWidth/2;
  const centerY = (window.innerHeight-50)/2;
  const radiusX = Math.min(window.innerWidth, window.innerHeight) * 0.35;
  const radiusY = Math.min(window.innerWidth, window.innerHeight) * 0.30;

  const allWords = [];
  for(let i=0;i<count;i++) allWords.push(distractors[Math.floor(Math.random()*distractors.length)]);
  allWords.push(targetWord);

  allWords.forEach(wordText => {
    const w = document.createElement('div');
    w.className='word';
    w.textContent=wordText;
    w.style.color=colors[Math.floor(Math.random()*colors.length)];
    if(wordText===targetWord) w.classList.add('target-word');
    currentLayer.appendChild(w);

    // 단어 위치
    const phi=Math.random()*Math.PI;
    const theta=Math.random()*2*Math.PI;
    const x = radiusX*Math.sin(phi)*Math.cos(theta);
    const y = radiusY*Math.sin(phi)*Math.sin(theta);
    const z = radiusY*Math.cos(phi);

    const wordObj = {el:w, x, y, z, progress:1}; // progress 1로 바로 보이게
    wordObjects.push(wordObj);

    w.addEventListener('click',(e)=>{
      if(w.classList.contains('correct')) return;
      if(wordText===currentTarget){
        w.classList.add('correct');
        w.style.transform='translate(-50%,-50%) scale(1.3)';
        w.style.opacity='1';
        w.style.pointerEvents='none';
        addToInventory(currentTarget);
        burstEffect(e.clientX,e.clientY);
        document.getElementById('win-count').textContent=parseInt(document.getElementById('win-count').textContent)+1;
        addRecordLog(`${currentTarget} 선택`);
        clearTimeout(roundTimer);
        clearInterval(countdownInterval);
        setTimeout(()=>startNextRound(),700);
      }
    });
  });
}

// ===== 회전 =====
function rotateWordsLoop(){
  const centerX=window.innerWidth/2;
  const centerY=(window.innerHeight-50)/2;
  const radiusY=Math.min(window.innerWidth,window.innerHeight)*0.30;
  let angleY=0;
  function loop(){
    angleY-=0.002;
    wordObjects.forEach(w=>{
      const x=w.x*Math.cos(angleY)-w.z*Math.sin(angleY);
      const z=w.x*Math.sin(angleY)+w.z*Math.cos(angleY);
      const y=w.y;
      const scale=(z+radiusY)/(2*radiusY)+0.5;
      w.el.style.left=`${centerX+x*scale}px`;
      w.el.style.top=`${centerY+y*scale}px`;
      if(!w.el.classList.contains('correct')) w.el.style.transform=`translate(-50%,-50%) scale(${scale})`;
      w.el.style.opacity=0.5+0.5*scale;
    });
    requestAnimationFrame(loop);
  }
  loop();
}

// ===== 라운드 =====
let remainingTargets=[...abilities];

function startNextRound(){
  if(roundTimer) clearTimeout(roundTimer);
  if(countdownInterval) clearInterval(countdownInterval);

  if(remainingTargets.length===0) remainingTargets=[...abilities];
  const idx=Math.floor(Math.random()*remainingTargets.length);
  currentTarget=remainingTargets[idx];
  remainingTargets.splice(idx,1);

  targetEl.textContent=currentTarget;
  if(!currentLayer){
    currentLayer=document.createElement('div');
    currentLayer.className='round-layer';
    area.appendChild(currentLayer);
    rotateWordsLoop();
  }
  spawnWords(currentTarget,50);

  // 10초 타이머
  let timeLeft=10;
  timerEl.textContent=timeLeft;
  countdownInterval=setInterval(()=>{
    timeLeft--;
    timerEl.textContent=timeLeft;
    if(timeLeft<=0) clearInterval(countdownInterval);
  },1000);

  roundTimer=setTimeout(()=>{
    document.getElementById('lose-count').textContent=parseInt(document.getElementById('lose-count').textContent)+1;
    addRecordLog(`${currentTarget} 시간 초과 실패`);
    startNextRound();
  },10000);
}

// ===== 빈 공간 클릭 =====
area.addEventListener('click',(e)=>{
  if(e.target.classList.contains('word')) return;
  const loseCountEl=document.getElementById('lose-count');
  loseCountEl.textContent=parseInt(loseCountEl.textContent)+1;
  addRecordLog(`빈 공간 클릭`);
});

// ===== 파티클 =====
const canvas=document.getElementById('particleCanvas');
const ctx=canvas.getContext('2d');
let particles=[];
function resizeCanvas(){ canvas.width=window.innerWidth; canvas.height=window.innerHeight; }
resizeCanvas(); window.addEventListener('resize',resizeCanvas);
document.addEventListener('mousemove',e=>{
  for(let i=0;i<2;i++) particles.push({x:e.clientX,y:e.clientY,vx:(Math.random()-0.5)*1.2,vy:(Math.random()-0.5)*1.2,life:25+Math.random()*10,size:1+Math.random()*1.8});
});
function drawParticles(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i]; p.x+=p.vx; p.y+=p.vy; p.life--;
    const alpha=Math.max(0,p.life/25);
    ctx.beginPath(); ctx.fillStyle=`rgba(0,153,255,${alpha})`; ctx.arc(p.x,p.y,p.size,0,Math.PI*2); ctx.fill();
    if(p.life<=0) particles.splice(i,1);
  }
  requestAnimationFrame(drawParticles);
}
drawParticles();

// ===== 시작 =====
startNextRound();
</script>
</body>
</html>
